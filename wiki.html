<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Pháp lý - Chung Cư Tốt</title>
    
   <link rel="icon" href="favicon.png" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/listing.css">
    <link rel="stylesheet" href="assets/css/menu.css">
</head>
<body>

    <div id="menu-overlay" class="menu-overlay"></div>
    <header class="header-wrapper">
        <div class="header-footer-limiter">
            <div class="site-header">
                <button class="hamburger-button" id="hamburger-button" aria-label="Mở menu">
                    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
                </button>
                <a href="index.html" class="logo-link"><img src="assets/images/logo.png" alt="Logo Chung Cư Tốt" class="logo"></a>
                <nav class="main-nav" id="main-nav">
                    <ul id="main-menu-list"></ul>
                </nav>
                <div class="header-actions">
                    <a href="favorites.html" class="header-favorite-btn" aria-label="Danh sách yêu thích">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg>
                        <span class="favorite-counter">0</span>
                    </a>
                    <a href="#" class="search-button-new" aria-label="Tìm kiếm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </header>
    <div id="cct-mega-menu">
    <div class="menu-panel-overlay"></div>
    <div class="menu-panel-columns">
        <div class="menu-panel-col col-1">
            <h4>Loại hình</h4>
            <ul id="mega-menu-col-1-list"></ul>
        </div>
        <div class="menu-panel-col col-2">
            <h4>Khu vực</h4>
            <ul id="mega-menu-col-2-list"></ul>
        </div>
        <div class="menu-panel-col col-3">
            <h4>Dự án nổi bật</h4>
            <div id="mega-menu-col-3-content"></div>
        </div>
    </div>
    </div>

    <div class="main-container">
        <div class="content-limiter">
            <div class="content-wrapper">
                <main class="main-column">
                    <div class="breadcrumb">
                        Wiki &gt; Pháp lý
                    </div>
                    
                    <div class="category-header">
                        <h1>Wiki Pháp lý</h1>
                        <p>Tổng hợp kiến thức pháp lý quan trọng trong lĩnh vực bất động sản.</p>
                    </div>

                    <section class="search-section">
                        <form class="search-form">
                            <input type="search" placeholder="Tìm kiếm kiến thức pháp lý...">
                            <div class="search-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                </svg>
                            </div>
                        </form>
                    </section>
                    
                    <div class="wiki-grid">
                        <a href="bai-viet-chi-tiet.html" class="wiki-card">
                            <div class="wiki-card-image">
                                <img src="assets/images/wiki.jpeg" alt="Sổ hồng chung cư">
                            </div>
                            <div class="wiki-card-content">
                                <h3 class="wiki-card-title">Sổ hồng chung cư là gì? Thời hạn và những điều cần biết</h3>
                                <p class="wiki-card-excerpt">Tổng hợp những thông tin quan trọng nhất về giấy chứng nhận quyền sở hữu căn hộ chung cư mà bất kỳ ai cũng cần nắm rõ...</p>
                                <span class="wiki-card-cta">Đọc bài viết →</span>
                            </div>
                        </a>
                        <a href="bai-viet-chi-tiet.html" class="wiki-card">
                            <div class="wiki-card-image">
                                <img src="assets/images/wiki1.jpeg" alt="Hợp đồng mua bán">
                            </div>
                            <div class="wiki-card-content">
                                <h3 class="wiki-card-title">5 Điều khoản cần kiểm tra kỹ trong Hợp đồng mua bán căn hộ</h3>
                                <p class="wiki-card-excerpt">Hợp đồng mua bán là văn bản pháp lý quan trọng nhất. Đây là những điều khoản bạn không thể bỏ qua để bảo vệ quyền lợi của mình.</p>
                                <span class="wiki-card-cta">Đọc bài viết →</span>
                            </div>
                        </a>
                        <a href="bai-viet-chi-tiet.html" class="wiki-card">
                            <div class="wiki-card-image">
                                <img src="assets/images/wiki.jpeg" alt="Phí bảo trì">
                            </div>
                            <div class="wiki-card-content">
                                <h3 class="wiki-card-title">Phí bảo trì chung cư 2%: Ai thu, dùng để làm gì?</h3>
                                <p class="wiki-card-excerpt">Giải đáp tất cả các thắc mắc phổ biến nhất xung quanh quỹ bảo trì 2% của tòa nhà chung cư theo quy định của pháp luật hiện hành.</p>
                                <span class="wiki-card-cta">Đọc bài viết →</span>
                            </div>
                        </a>
                        <a href="bai-viet-chi-tiet.html" class="wiki-card">
                            <div class="wiki-card-image">
                                <img src="assets/images/wiki1.jpeg" alt="Mua nhà trên giấy">
                            </div>
                            <div class="wiki-card-content">
                                <h3 class="wiki-card-title">Rủi ro khi mua nhà "trên giấy" và cách phòng tránh hiệu quả</h3>
                                <p class="wiki-card-excerpt">Mua nhà hình thành trong tương lai có thể giúp bạn có giá tốt, nhưng cũng tiềm ẩn nhiều rủi ro nếu không tìm hiểu kỹ lưỡng...</p>
                                <span class="wiki-card-cta">Đọc bài viết →</span>
                            </div>
                        </a>
                    </div>

                    <nav class="pagination">
                        <a href="#" class="active">1</a>
                        <a href="#">2</a>
                        <a href="#">&raquo;</a>
                    </nav>

                </main>

                <aside class="sidebar-column">
                    <div class="widget">
                        <h3 class="widget-title">Chủ đề được quan tâm</h3>
                        <ul>
                            <li><a href="#">Hợp đồng mua bán</a></li>
                            <li><a href="#">Sổ hồng & Pháp lý</a></li>
                            <li><a href="#">Tranh chấp chung cư</a></li>
                            <li><a href="#">Quy định PCCC</a></li>
                        </ul>
                    </div>
                     <div class="widget">
                        <h3 class="widget-title">Quảng cáo</h3>
                        <a href="#"><img src="assets/images/banner-quangcao.jpg" alt="Quảng cáo" style="border-radius: 8px;"></a>
                    </div>
                </aside>
            </div>
        </div>
    </div>
    <div id="favorites-drawer-container">
        <div class="favorites-drawer-overlay"></div>
        <div class="favorites-drawer">
            <div class="drawer-header">
                <h3>Danh sách yêu thích</h3>
                <button class="drawer-close-btn" title="Đóng">&times;</button>
            </div>
            <div class="drawer-content">
                </div>
        
        </div>
    </div>
    <footer class="footer-wrapper">
        <div class="header-footer-limiter">
            <div class="site-footer">
                <div class="footer-widget footer-col-1">
                     <a href="index.html">
                        <img src="assets/images/logo-footer.png" alt="Logo Footer" class="footer-logo">
                    </a>
                    <p><b>Chung cư tốt / Tên Công ty</b></p>
                    <p>Số điện thoại: <a href="tel:0123456789">0123 456 789</a></p>
                    <p>Mail: <a href="mailto:info@chungcutot.vn">info@chungcutot.vn</a></p>
                    
                </div>

                <div class="footer-widget">
                    <h4 class="widget-title accordion-toggle">VỀ CHÚNG TÔI</h4>
                    <ul class="widget-links">
                        <li><a href="gioi-thieu.html">Giới thiệu</a></li>
                        <li><a href="doi-ngu.html">Đội ngũ</a></li>
                        <li><a href="lien-he.html">Liên hệ</a></li>
                    </ul>
                </div>

                <div class="footer-widget">
                    <h4 class="widget-title accordion-toggle">ĐIỀU KHOẢN</h4>
                    <ul class="widget-links">
                        <li><a href="chinh-sach-bao-mat.html">Chính sách bảo mật</a></li>
                        <li><a href="dieu-khoan-su-dung.html">Điều khoản sử dụng</a></li>
                    </ul>
                </div>

                <div class="footer-widget footer-col-4">
                    <h4 class="widget-title">KẾT NỐI VỚI CHÚNG TÔI</h4>

                    <div class="footer-socials">
                        <a href="#" class="social-icon" aria-label="Facebook">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m13 2h-2.5a3.5 3.5 0 0 0-3.5 3.5V11h-2v3h2v7h3v-7h3v-3h-3V8.5A.5.5 0 0 1 15 8h3V5z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-icon" aria-label="YouTube">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24">
                                <path d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33.22 2.65.28 1.3.07 2.49.1 3.59.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-icon" aria-label="LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="white">
                                <path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4s1.39.63 1.39 1.4v4.93h2.8zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69s-1.68.76-1.68 1.69c0 .92.75 1.68 1.68 1.68zm-1.39 1.3h2.79v8.37H5.5V9.86z"/>
                            </svg>
                        </a>
                    </div>

                    <a href="#" target="_blank" rel="noopener noreferrer" style="margin-top: 20px; display: inline-block;">
                        <img src="assets/images/bo-cong-thuong.png" alt="Logo Bộ Công Thương" class="bct-logo">
                    </a>
                </div>
            </div>
             <div class="copyright-text">
                <p>Copyright 2025 - Bản quyền của Chung cư Tốt</p>
            </div>
        </div>
    </footer>
    <script src="assets/js/template.js"></script>
    <script type="module" src="assets/js/data-menu.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/listing.js"></script>
    <script type="module">
    // =====================================================================
    // == SCRIPT TỔNG HỢP CUỐI CÙNG (DESKTOP & MOBILE & STICKY HEADER) ==
    // =====================================================================

    document.addEventListener('DOMContentLoaded', () => {

        // --- PHẦN 1: DỮ LIỆU & BIẾN TOÀN CỤC ---
        const initialMenuData = {
           "Dự án": [ { "Loại hình": "Chung cư", "Khu vực": ["TP. Hồ Chí Minh", "Bình Dương", "Đồng Nai"] }, { "Loại hình": "Khu đô thị", "Khu vực": ["TP. Hồ Chí Minh", "Hà Nội", "Long An"] } ],
           "Mua bán": [ { "Loại hình": "Căn hộ", "Khu vực": ["TP. Hồ Chí Minh", "Lâm Đồng", "Bà Rịa - Vũng Tàu"] }, { "Loại hình": "Shophouse", "Khu vực": ["TP. Hồ Chí Minh", "Hà Nội", "Đà Nẵng"] } ],
           "Cho thuê": [ { "Loại hình": "Căn hộ", "Khu vực": ["TP. Hồ Chí Minh", "Hà Nội"] }, { "Loại hình": "Shophouse", "Khu vực": ["TP. Hồ Chí Minh", "Hà Nội", "Vĩnh Long"] } ],
           "Wiki": [ { "Danh mục": "Pháp lý", "slug": "phap-ly" }, { "Danh mục": "Kinh nghiệm", "slug": "kinh-nghiem" }, { "Danh mục": "Phong thuỷ", "slug": "phong-thuy" } ],
           "Tin tức": [ { "Danh mục": "Dự án", "slug": "du-an" }, { "Danh mục": "Thị trường", "slug": "thi-truong" } ],
           "Doanh nghiệp": [ { "Danh mục": "Chủ đầu tư", "slug": "chu-dau-tu" }, { "Danh mục": "Nhà thầu thi công", "slug": "nha-thau-thi-cong" } ]
        };
        
        const featuredProjectsData = [
            {
                name: 'The Global City',
                description: 'Khu đô thị phức hợp chuẩn quốc tế tại TP. Thủ Đức.',
                image: 'assets/images/project-gallery-1.jpg',
                link: '#'
            }
        ];

        const header = document.querySelector('.header-wrapper');
        const mainMenuContainer = document.getElementById('main-nav');
        const mainMenuUl = document.getElementById('main-menu-list');
        const hamburgerButton = document.getElementById('hamburger-button');
        const menuOverlay = document.getElementById('menu-overlay');
        const megaMenuContainer = document.getElementById('cct-mega-menu');
        
        let activeMenuItem = null;
        let menuTimeout;

        // --- PHẦN 2: CÁC HÀM TIỆN ÍCH ---
        const toSlug = (str) => {
            if (!str) return '';
            let s = str.toLowerCase();
            if (s === 'hồ chí minh') return 'tp-ho-chi-minh';
            if (s === 'hà nội') return 'tp-ha-noi';
            if (s === 'đà nẵng') return 'tp-da-nang';
            if (s === 'cần thơ') return 'tp-can-tho';
            if (s === 'hải phòng') return 'tp-hai-phong';
            s = s.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            s = s.replace(/[đĐ]/g, 'd');
            s = s.replace(/([^0-9a-z-\s])/g, '');
            s = s.replace(/(\s+)/g, '-');
            s = s.replace(/-+/g, '-');
            s = s.replace(/^-+|-+$/g, '');
            return s;
        };
        
        function getLink(menuKey, catKey, subItem) {
            let baseUrl = '';
            let params = [];
            const lowerMenuKey = menuKey.toLowerCase();
            const categorySlug = toSlug(catKey);
            if (lowerMenuKey.includes('dự án'))
            baseUrl = 'list-du-an.html'; // Đổi thành URL cho trang dự án
            else if (lowerMenuKey.includes('bán')) baseUrl = 'listing-ban.html';
            else if (lowerMenuKey.includes('thuê')) baseUrl = 'listing-thue.html';
            else if (lowerMenuKey.includes('wiki')) baseUrl = 'wiki.html';
            else if (lowerMenuKey.includes('tin tức')) baseUrl = 'news.html';
            else if (lowerMenuKey.includes('doanh nghiệp')) baseUrl = 'business.html';
            else baseUrl = 'listing.html';
            if (catKey) {
                let paramKey = ['Dự án', 'Mua bán', 'Cho thuê'].includes(menuKey) ? 'loaihinh' : 'danh-muc';
                params.push(`${paramKey}=${categorySlug}`);
            }
            if (subItem) {
                params.push(`thanhpho=${toSlug(subItem)}`);
            }
            return `${baseUrl}${params.length > 0 ? '?' : ''}${params.join('&')}`;
        }

        function debounce(func, delay = 250) {
            let timeout;
            return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); };
        }

        // --- PHẦN 3: LOGIC MENU ---

        function initMenu() {
            if (window.innerWidth > 1024) {
                handleDesktopMenu();
            } else {
                handleMobileMenu();
            }
        }
        
        function handleDesktopMenu() {
            const nav = document.getElementById('main-nav');
            const mainMenu = document.getElementById('main-menu-list');
            if (!nav || !mainMenu || !megaMenuContainer) return;
            mainMenu.innerHTML = ''; 
            for (const menuKey in initialMenuData) {
                const li = document.createElement('li');
                li.className = 'has-dropdown';
                const a = document.createElement('a');
                a.href = '#'; 
                a.textContent = menuKey;
                li.appendChild(a);
                mainMenu.appendChild(li);
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (activeMenuItem === e.target.parentElement) {
                        closeDesktopPanel();
                    } else {
                        if (activeMenuItem) activeMenuItem.classList.remove('active');
                        activeMenuItem = e.target.parentElement;
                        activeMenuItem.classList.add('active');
                        populateDesktopPanel(menuKey);
                        setTimeout(() => megaMenuContainer.classList.add('is-open'), 10);
                    }
                });
            }
            megaMenuContainer.querySelector('.menu-panel-overlay')?.addEventListener('click', closeDesktopPanel);
            nav.addEventListener('mouseleave', () => { menuTimeout = setTimeout(closeDesktopPanel, 300); });
            nav.addEventListener('mouseenter', () => clearTimeout(menuTimeout));
            megaMenuContainer.addEventListener('mouseenter', () => clearTimeout(menuTimeout));
            megaMenuContainer.addEventListener('mouseleave', () => { menuTimeout = setTimeout(closeDesktopPanel, 300); });
        }

        function populateDesktopPanel(menuKey) {
            const menuItems = initialMenuData[menuKey];
            const col1List = document.getElementById('mega-menu-col-1-list');
            const col2List = document.getElementById('mega-menu-col-2-list');
            const col3Content = document.getElementById('mega-menu-col-3-content');
            if (!col1List || !col2List || !col3Content) return;
            col1List.innerHTML = '';
            col2List.innerHTML = '';
            col3Content.innerHTML = '';
            const firstItem = menuItems[0];
            const isMega = firstItem.hasOwnProperty('Khu vực');
            megaMenuContainer.querySelector('.menu-panel-columns').classList.toggle('is-single-col-data', !isMega);
            menuItems.forEach((item, index) => {
                const categoryName = item["Loại hình"] || item["Danh mục"];
                const li = document.createElement('li');
                li.dataset.category = categoryName;
                if (isMega) {
                    li.textContent = categoryName;
                } else {
                    const link = document.createElement('a');
                    link.href = getLink(menuKey, categoryName);
                    link.textContent = categoryName;
                    link.className = 'direct-link';
                    li.appendChild(link);
                }
                if (index === 0) li.classList.add('active');
                col1List.appendChild(li);
            });
            if (isMega) {
                updateDesktopSubMenu(menuItems[0]["Loại hình"], menuKey);
                col1List.addEventListener('mouseover', e => {
                    const targetLi = e.target.closest('li');
                    if (targetLi && targetLi.dataset.category) {
                        col1List.querySelectorAll('li').forEach(li => li.classList.remove('active'));
                        targetLi.classList.add('active');
                        updateDesktopSubMenu(targetLi.dataset.category, menuKey);
                    }
                });
            }
            featuredProjectsData.forEach(project => {
                const card = document.createElement('a');
                card.href = project.link;
                card.className = 'featured-project-card';
                card.innerHTML = `<img src="${project.image}" alt="${project.name}"><div class="featured-project-info"><h5>${project.name}</h5><p>${project.description}</p></div>`;
                col3Content.appendChild(card);
            });
        }
        
        function updateDesktopSubMenu(categoryKey, menuKey) {
            const subMenuContainer = document.getElementById('mega-menu-col-2-list');
            const menuItems = initialMenuData[menuKey];
            const targetItem = menuItems.find(item => item["Loại hình"] === categoryKey);
            const subItems = targetItem ? targetItem["Khu vực"] : [];
            subMenuContainer.innerHTML = subItems.map(item => `<li><a href="${getLink(menuKey, categoryKey, item)}">${item}</a></li>`).join('');
        }

        function closeDesktopPanel() {
            if (megaMenuContainer) megaMenuContainer.classList.remove('is-open');
            if (activeMenuItem) {
                activeMenuItem.classList.remove('active');
                activeMenuItem = null;
            }
        }

        function handleMobileMenu() {
          
            const nav = document.getElementById('main-nav');
            const overlay = document.getElementById('menu-overlay');
            const hamburger = document.getElementById('hamburger-button');
            if (!nav || !overlay || !hamburger) return;
            nav.innerHTML = '<div class="menu-slider"></div>';
            const slider = nav.querySelector('.menu-slider');
            const createPanel = (level, title, content) => {
                const panel = document.createElement('div');
                panel.className = 'menu-panel';
                panel.dataset.level = level;
                let headerHTML = `<h4 class="panel-title">${title}</h4>`;
                if (level > 0) {
                    headerHTML = `<a href="#" class="panel-back-button"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></a>` + headerHTML;
                } else {
                    headerHTML += `<button class="mobile-menu-close">&times;</button>`;
                }
                panel.innerHTML = `<div class="panel-header">${headerHTML}</div><ul class="panel-list">${content}</ul>`;
                return panel;
            };
            const openMenu = () => {
                if (!slider.querySelector('[data-level="0"]')) {
                    const level1Content = Object.keys(initialMenuData).map(key => `<li class="has-submenu" data-level="0" data-key="${key}"><a href="#">${key}</a></li>`).join('');
                    const panel1 = createPanel(0, 'Menu', level1Content);
                    slider.appendChild(panel1);
                    panel1.querySelector('.mobile-menu-close').addEventListener('click', closeMenu);
                }
                nav.classList.add('is-open');
                overlay.classList.add('is-visible');
                document.body.style.overflow = 'hidden';
            };
            const closeMenu = () => {
                nav.classList.remove('is-open');
                overlay.classList.remove('is-visible');
                document.body.style.overflow = '';
                setTimeout(() => {
                    slider.style.transform = 'translateX(0%)';
                    slider.querySelectorAll('.menu-panel').forEach(p => { if (p.dataset.level > 0) p.remove(); });
                }, 350);
            };
            hamburger.onclick = openMenu;
            overlay.onclick = closeMenu;
            slider.addEventListener('click', (e) => {
                const linkTarget = e.target.closest('a');
                if (linkTarget && linkTarget.getAttribute('href') !== '#') {
                    closeMenu();
                    return;
                }
                e.preventDefault();
                const target = e.target;
                const currentPanel = target.closest('.menu-panel');
                if (!currentPanel) return;
                if (target.closest('.panel-back-button')) {
                    const currentLevel = parseInt(currentPanel.dataset.level, 10);
                    slider.style.transform = `translateX(-${(currentLevel - 1) * 100}%)`;
                    setTimeout(() => currentPanel.remove(), 350);
                    return;
                }
                const targetLi = target.closest('li[data-key]');
                const backButton = e.target.closest('.panel-back-button');
                if (backButton) {
                    e.preventDefault(); // Ngăn hành vi mặc định của thẻ <a>
                    const currentPanel = backButton.closest('.menu-panel');
                    if (currentPanel) {
                        const currentLevel = parseInt(currentPanel.dataset.level, 10);
                        // Lùi slider về panel trước đó
                        slider.style.transform = `translateX(-${(currentLevel - 1) * 100}%)`;
                        // Xóa panel hiện tại sau khi hiệu ứng kết thúc
                        setTimeout(() => currentPanel.remove(), 350);
                    }
                    return; // Dừng xử lý tại đây
                }
                if (targetLi) {
            // Ngăn chuyển trang nếu là link '#'
            if(e.target.closest('a')?.getAttribute('href') === '#') {
                 e.preventDefault();
            }

            const level = parseInt(targetLi.dataset.level, 10);
            const menuKey = targetLi.dataset.key;
            const category = targetLi.dataset.category;
            let nextLevelContent = '', nextLevelTitle = '';

            // Từ Cấp 1 -> Cấp 2
            if (level === 0) {
                nextLevelTitle = menuKey;
                const items = initialMenuData[menuKey];
                nextLevelContent = items.map(item => {
                    const name = item["Loại hình"] || item["Danh mục"];
                    const hasSubmenu = item.hasOwnProperty('Khu vực');
                    const link = hasSubmenu ? '#' : getLink(menuKey, name, null);
                    return `<li class="${hasSubmenu ? 'has-submenu' : ''}" data-level="1" data-key="${menuKey}" data-category="${name}"><a href="${link}">${name}</a></li>`;
                }).join('');
            }
            // Từ Cấp 2 -> Cấp 3
            else if (level === 1) {
                const parentItem = initialMenuData[menuKey].find(item => (item["Loại hình"] || item["Danh mục"]) === category);
                if (!parentItem || !parentItem["Khu vực"]) return;
                
                nextLevelTitle = category;
                const khuVucItems = parentItem["Khu vực"];
                nextLevelContent = khuVucItems.map(kv => `<li><a href="${getLink(menuKey, category, kv)}">${kv}</a></li>`).join('');
            }

            // Tạo và trượt đến panel tiếp theo
            if (nextLevelContent) {
                const newPanel = createPanel(level + 1, nextLevelTitle, nextLevelContent);
                slider.appendChild(newPanel);
                slider.style.transform = `translateX(-${(level+1) * 100}%)`;
            }
        }
            });
        }
        
        // --- PHẦN 4: CÁC SỰ KIỆN TOÀN CỤC ---
        
        // Sự kiện cuộn trang (cho Sticky Header và Đóng Menu)
        if (header) {
            let lastScrollTop = 0;
            const sidebar = document.querySelector('.listing-filter-sidebar, .contact-sidebar, .sidebar-column'); 
            window.addEventListener('scroll', () => {
                // Sticky header
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (scrollTop > lastScrollTop && scrollTop > header.offsetHeight) {
                    header.classList.add('header--hidden');
                    if (sidebar) sidebar.classList.add('sidebar--header-hidden');
                } else {
                    header.classList.remove('header--hidden');
                    if (sidebar) sidebar.classList.remove('sidebar--header-hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;

                // [THÊM MỚI] Tự động đóng menu desktop khi cuộn
                if (megaMenuContainer && megaMenuContainer.classList.contains('is-open')) {
                    closeDesktopPanel();
                }
            });
        }

        // Sự kiện click bên ngoài để đóng Desktop Menu
        document.addEventListener('click', (event) => {
            if (megaMenuContainer && mainMenuContainer && megaMenuContainer.classList.contains('is-open')) {
                // Nếu click ra ngoài cả thanh nav và cả panel menu
                if (!mainMenuContainer.contains(event.target) && !megaMenuContainer.contains(event.target)) {
                    closeDesktopPanel();
                }
            }
        });

        // Sự kiện thay đổi kích thước cửa sổ
        window.addEventListener('resize', debounce(initMenu, 250));
        

        // --- PHẦN 5: KHỞI CHẠY LẦN ĐẦU ---
        initMenu();
    });
    </script>
    
</body>
</html>